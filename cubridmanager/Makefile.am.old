
SRC = $(top_srcdir)/src
CM_DIR = ${top_srcdir}/cubridmanager

DROP_DIR = drop
OUT_DIR = out
WIN32_DIR = win32
LINUX_DIR = cmclient.motif
LINUX_GTK_DIR = cmclient.gtk
RCP_DIR = ${CM_DIR}/rcpfiles
CONFIG = configuration
CUBRIDMANAGER = cubridmanager
WIN32_DEPLOY = $(WIN32_DIR)
LINUX_DEPLOY = $(LINUX_DIR)
LINUX_GTK_DEPLOY = $(LINUX_GTK_DIR)
WIN32_CONFIG = $(WIN32_DEPLOY)/$(CONFIG)
LINUX_CONFIG = $(LINUX_DEPLOY)/$(CONFIG)
LINUX_GTK_CONFIG = $(LINUX_GTK_DEPLOY)/$(CONFIG)

cmdir = ${prefix}/${CUBRIDMANAGER}

all: all-am ant-build win32 linux linux-gtk

ant-build:
	ant dist -buildfile ${CM_DIR}/build.xml -Dbasedir=. -Dsrc=${CM_DIR}/src -Dcubridmanager.location=${CM_DIR} -Declipse.plugins=${CM_DIR}/rcpfiles -Djdbc.file=../jdbc/JDBC-@BUILD_NUMBER@.jar

win32: ant-build
	mkdir -p $(WIN32_CONFIG)
	mkdir -p $(WIN32_DEPLOY)/lib
	cp -rf $(DROP_DIR)/* $(WIN32_DEPLOY)
	cp $(RCP_DIR)/config.ini.win32 $(WIN32_CONFIG)/config.ini
	cp $(RCP_DIR)/launcher.exe $(WIN32_DEPLOY)/cubridmanager.exe
	cp $(RCP_DIR)/CertProcess.dll     $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/GPKICertManager.dll $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/cub_readcert.dll  $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/gpkiapi.dll       $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/gpkiapi_jni.dll   $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/mfc42.dll         $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/mfc71.dll         $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/msvcr71.dll       $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/msvcrt.dll        $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/nsldap32v11.dll   $(WIN32_DEPLOY)/lib
	cp $(RCP_DIR)/upa_j.dll         $(WIN32_DEPLOY)/lib

linux: ant-build
	mkdir -p $(LINUX_CONFIG)
	cp -rf $(DROP_DIR)/* $(LINUX_DEPLOY)
	cp $(RCP_DIR)/config.ini.linux $(LINUX_CONFIG)/config.ini
	cp $(RCP_DIR)/launcher.linux $(LINUX_DEPLOY)/.cmclient_bin
	cp $(RCP_DIR)/launcher.motif.sh $(LINUX_DEPLOY)/cubridmanager

linux-gtk: ant-build
	mkdir -p $(LINUX_GTK_CONFIG)
	cp -rf $(DROP_DIR)/* $(LINUX_GTK_DEPLOY)
	cp $(RCP_DIR)/config.ini.linux.gtk $(LINUX_GTK_CONFIG)/config.ini
	cp $(RCP_DIR)/launcher.linux.gtk $(LINUX_GTK_DEPLOY)/.cmclient_bin
	cp $(RCP_DIR)/libcairo.so.1 $(LINUX_GTK_DEPLOY)/libcairo.so.1
	cp $(RCP_DIR)/launcher.gtk.sh $(LINUX_GTK_DEPLOY)/cubridmanager

clean-am: clean-generic clean-libtool mostlyclean-am
	ant clean -buildfile ${top_srcdir}/cubridmanager/build.xml -Dbasedir=.  
	rm -rf ${WIN32_DIR} ${LINUX_DIR} ${LINUX_GTK_DIR} ${CUBRIDMANAGER}

install-exec-hook:
	test -z "$(cmdir)" || mkdir -p "$(cmdir)"
	rm -rf ${cmdir}/cmclient*
	cp -r cmclient* ${cmdir}
	cd $(cmdir) && $(LN_S) -f ${LINUX_GTK_DIR} cmclient
