
<html>
<head>
<title>트리거를 이용한 응용</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link type="text/css" rel="stylesheet" href="../nhelp.css" />
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
</style>
<script type="text/javascript" language="javascript1.2" src="../whmsg.js"></script>
<script type="text/javascript" language="javascript" src="../whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whlang.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whtopic.js"></script>

 <meta name="generator" content="Adobe RoboHelp 8" />
</head>
<body><script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.gbWhTopic)
{
	var strUrl = document.location.href;
	var bc = 0;
	var n = strUrl.toLowerCase().indexOf("bc-");
	if(n != -1)
	{
		document.location.href = strUrl.substring(0, n);
		bc = strUrl.substring(n+3);
	}

	if (window.addTocInfo)
	{
	addTocInfo("CUBRID SQL 설명서\n트리거(TRIGGER)\n트리거를 이용한 응용");
         if(strUrl.toLowerCase().indexOf("/help/")==-1){

    addButton("show",BTN_TEXT,"Show","","","","",0,0,"","","");

    }


	}
	if (window.writeBtnStyle)
		writeBtnStyle();

	if (window.writeIntopicBar)
		writeIntopicBar(1);if(strUrl.toLowerCase().indexOf("/help/")==-1){

         document.write("<p style=\"text-align:left\"> ");

AddMasterBreadcrumbs("../index.htm", "", "&nbsp;&gt;&nbsp;", "홈", "../cubrid.htm");

document.write("<a href=\"syntax.htm\">CUBRID SQL 설명서<\/a> &nbsp;&gt;&nbsp; <a href=\"syntax_trigger_create_guideline.htm\">트리거(TRIGGER)<\/a> &nbsp;&gt;&nbsp; 트리거를 이용한 응용<\/p>");}


	if (window.setRelStartPage)
	{
	setRelStartPage("../index.htm");

		autoSync(1);
		sendSyncInfo();
		sendAveInfoOut();
	}
}
else
	if (window.gbIE4)
		document.location.reload();

//-->
//]]></script>
<h4>트리거를 이용한 응용</h4>
<p>여기에서는 데모 데이터베이스에 있는 트리거 정의에 대해 알아본다.</p>
<p>demodb 데이터베이스에 생성되어 있는 트리거는 그리 복잡하지는 않지만 CUBRID에서 사용할 수 있는 대부분의 기능을 활용한다.</p>
<p>사용자 데이터베이스에 직접 생성한 트리거는 사용자가 만든 응용 프로그램만큼이나 강력할 수 있다.</p>
<h6>데모 데이터베이스에 생성된 트리거</h6>
<p>여기에서는 데모 데이터베이스 내의 테이블을 사용하여 생성한 트리거에 대해 설명한다.&#160;이러한 트리거를 테스트할 때, demodb 데이터베이스의 원형을 유지하고 싶다면 데이터에 변경이 있은 후 롤백을 수행해야 한다.&#160;</p>
<ul>
<li class="title">예제&#160;1</li>
<li class="desc">participant 테이블에 만들어진 아래 트리거는 제시된 값이 0보다 작을 때 메달 컬럼(gold, silver, bronze)에 대한 업데이트를 거절한다. 트리거의 조건에 상관명 new가 사용되었기 때문에 시작 시점(evaluation time)은 반드시 <span class="keyword">BEFORE</span>가 되어야 한다. 비록 기술하지는 않았지만, 이 트리거에서 실행 시점(action time) 또한 <span class="keyword">BEFORE</span>이다.</li>
</ul>
<p class="code">CREATE TRIGGER medal_trigger<br />
BEFORE UPDATE ON&#160;participant<br />
IF new.gold &lt; 0 OR new.silver &lt; 0 OR new.bronze &lt; 0<br />
EXECUTE REJECT;&#160;</p>
<ul>
<li class="desc">국가코드가 'BLA'인 나라의 금메달(gold) 수를 업데이트 할 때, medal_trigger 트리거가 발동한다. 금메달 수가 음수인 경우를 허용하지 않도록 트리거를 생성하였으므로, 업데이트를 허용하지 않는다.</li>
</ul>
<p class="code">UPDATE participant<br />
SET gold = -10<br />
WHERE nation_code = 'BLA';</p>
<ul>
<li class="title">예제 2</li>
<li class="desc">아래 트리거는 위의 예제와 같은 조건인데, status inactive 가 추가된 경우이다. status 문이 생략될 경우 기본값은 active이며, alter trigger문에 의해 status 를 inactive로 변경할 수 있다.</li>
<li class="desc">status 의 값에 따라 트리거의 실행 여부를 지정할 수 있다.</li>
</ul>
<p class="code">CREATE TRIGGER medal_trig<br />
STATUS ACTIVE<br />
BEFORE UPDATE ON participant<br />
IF new.gold &lt; 0 OR new.silver &lt; 0 OR new.bronze &lt; 0<br />
EXECUTE REJECT;</p>
<p class="code">ALTER TRIGGER medal_trig<br />
STATUS INACTIVE;<br /></p>
<ul>
<li class="title">예제 3</li>
<li class="desc">다음 트리거는 트랜잭션이 커밋되었을 때 어떻게 무결성 제약 조건을 강제적으로 수행하는지 보여 준다. 하나의 트리거가 여러 테이블에 대해 지정 조건을 넣을 수 있다는 점이 이전 예제와 다르다.</li>
</ul>
<p class="code">CREATE TRIGGER check_null_first<br />
BEFORE COMMIT<br />
IF 0 &lt; (SELECT count(*) FROM athlete WHERE gender IS NULL)<br />
OR 0 &lt; (SELECT count(*) FROM game WHERE nation_code IS NULL)<br />
EXECUTE REJECT;</p>
<ul>
<li class="title">예제 4</li>
<li class="desc">다음 트리거는 record 테이블에 대해서 트랜잭션이 커밋 될 때까지 업데이트 무결성 제약조건 검사를 지연시킨다. DEFERRED 키워드가 이벤트 시점으로 주어졌기 때문에 업데이트 실행 시점에 정확하게 시작될 필요는 없다.</li>
</ul>
<p class="code">CREATE TRIGGER deferred_check_on_record<br />
DEFERRED UPDATE ON record<br />
IF obj.score = '100'<br />
EXECUTE INVALIDATE TRANSACTION;</p>
<ul>
<li class="desc">record 테이블에서 업데이트가 완료 되었을 때, 해당 업데이트는 현재 트랜잭션의 마지막(커밋이나 롤백 할 때)에 확인하게 된다. 상관명 old는 deferred update를 사용하는 트리거의 조건 절에 사용할 수 없다. 따라서 아래와 같은 트리거는 생성할 수 없다.</li>
</ul>
<p class="code">CREATE CLASS foo (n int);<br />
CREATE TRIGGER foo_trigger<br />
&#160;&#160;&#160;&#160;DEFERRED UPDATE ON foo<br />
&#160;&#160;&#160;&#160;IF old.n = 100<br />
&#160;&#160;&#160;&#160;EXECUTE PRINT 'foo_trigger';</p>
<ul>
<li class="desc">위와 같이 트리거를 생성하려고 하면 다음과 같은 에러 메시지를 보여주고, 실패한다.</li>
</ul>
<p class="code"><span class="cour9"><span lang="EN-US" style='font-size: 9.0pt;mso-fareast-font-family:바탕;mso-font-kerning:1.0pt;mso-ansi-language:EN-US; mso-fareast-language:KO;mso-bidi-language:AR-SA' xml:lang="EN-US">ERROR: Error compiling condition for 'foo_trigger' : old.n is not defined</span></span><span lang="EN-US" style='font-size:10.0pt;font-family:"바탕","serif";mso-hansi-font-family: "Times New Roman";mso-bidi-font-family:바탕;mso-font-kerning:1.0pt;mso-ansi-language: EN-US;mso-fareast-language:KO;mso-bidi-language:AR-SA' xml:lang="EN-US">.</span></p>
<ul>
<li class="desc">상관명 old는 트리거의 조건 시간이 after에서만 사용될 수 있다.</li>
</ul>
<script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.writeIntopicBar)
	writeIntopicBar(0);


highlightSearch();
//-->
//]]></script>
</body>
</html>
