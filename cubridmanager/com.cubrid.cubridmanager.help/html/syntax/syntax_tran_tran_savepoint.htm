
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="layout-height" content="25810" />
<meta name="layout-width" content="1072" />
<title>세이브포인트와 부분 롤백</title>
<link href="../nhelp.css" rel="Stylesheet" type="text/css" />
 <meta name="generator" content="Adobe RoboHelp 8" />
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
</style>
<script type="text/javascript" language="javascript1.2" src="../whmsg.js"></script>
<script type="text/javascript" language="javascript" src="../whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whlang.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whtopic.js"></script>

</head>
<body><script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.gbWhTopic)
{
	var strUrl = document.location.href;
	var bc = 0;
	var n = strUrl.toLowerCase().indexOf("bc-");
	if(n != -1)
	{
		document.location.href = strUrl.substring(0, n);
		bc = strUrl.substring(n+3);
	}

	if (window.addTocInfo)
	{
	addTocInfo("CUBRID SQL 설명서\n트랜잭션 관리\n데이터베이스 트랜잭션\n세이브포인트와 부분 롤백");
         if(strUrl.toLowerCase().indexOf("/help/")==-1){

    addButton("show",BTN_TEXT,"Show","","","","",0,0,"","","");

    }


	}
	if (window.writeBtnStyle)
		writeBtnStyle();

	if (window.writeIntopicBar)
		writeIntopicBar(1);if(strUrl.toLowerCase().indexOf("/help/")==-1){

         document.write("<p style=\"text-align:left\"> ");

AddMasterBreadcrumbs("../index.htm", "", "&nbsp;&gt;&nbsp;", "홈", "../cubrid.htm");

document.write("<a href=\"syntax.htm\">CUBRID SQL 설명서<\/a> &nbsp;&gt;&nbsp; <a href=\"syntax_tran_intro.htm\">트랜잭션 관리<\/a> &nbsp;&gt;&nbsp; <a href=\"syntax_tran_tran_intro.htm\">데이터베이스 트랜잭션<\/a> &nbsp;&gt;&nbsp; 세이브포인트와 부분 롤백<\/p>");}


	if (window.setRelStartPage)
	{
	setRelStartPage("../index.htm");

		autoSync(1);
		sendSyncInfo();
		sendAveInfoOut();
	}
}
else
	if (window.gbIE4)
		document.location.reload();

//-->
//]]></script>
<h4>세이브포인트와 부분 롤백</h4>
<h6>설명</h6>
<p>세이브포인트(savepoint)는 트랜잭션이 진행되는 중에 수립되는데, 트랜잭션에 의해 수행되는 데이터베이스 갱신을 세이브포인트 지점까지만 롤백할 수 있도록 하기 위해서이다. 이 연산을 부분 롤백(partial rollback)이라고 부른다. 부분 롤백에서는 세이브포인트 이후의 데이터베이스 연산(삽입, 삭제, 갱신 등)은 하지 않은 것으로 되고 세이브포인트 지점을 포함하여 이전에 진행된 트랜잭션의 연산은 그대로 유지된다. 부분 롤백이 실행된 후에 트랜잭션은 다른 연산을 계속 진행할 수 있다. 또는 <span class="keyword">COMMIT WORK</span> 문이나 <span class="keyword">ROLLBACK WORK</span> 문으로 트랜잭션을 끝낼 수도 있다. 세이브포인트는 트랜잭션에서 수행된 갱신을 커밋하는 것이 아님을 명심해야 한다.</p>
<p>세이브포인트는 트랜잭션의 어느 시점에서도 만들 수 있고 몇 개의 세이브포인트라도 어떤 주어진 시점에 사용될 수 있다. 특정 세이브포인트보다 앞선 세이브포인트로 부분 롤백이 수행되거나 <span class="keyword">COMMIT WORK</span> 또는 <span class="keyword">ROLLBACK WORK</span> 문으로 트랜잭션이 끝나면 특정 세이브포인트는 제거된다. 특정 세이브포인트 이후에 대한 부분 롤백은 여러 번 수행될 수 있다.</p>
<p>세이브포인트는 길고 복잡한 프로그램을 통제할 수 있도록 중간 단계를 만들고 이름을 붙일 수 있기 때문에 유용하다. 예를 들어, 많은 갱신 연산 수행 시 세이브포인트를 사용하면 실수를 했을 때 모든 문장을 다시 수행할 필요가 없다.</p>
<h6>구문</h6>
<p class="syntax"><span class="keyword">SAVEPOINT</span> <span class="var">mark</span>;<br />
<span class="var">mark</span>:<br />
_ a SQL identifier<br />
_ a host variable (starting with :)</p>
<p>같은 트랜잭션 내에 여러 개의 세이브포인트를 지정할 때 <span class="var">mark</span>를 같은 값으로 하면 마지막 세이브포인트만 부분 롤백에 나타난다. 그리고 이전의 세이브포인트는 제일 마지막 세이브포인트로 부분 롤백할 때까지 감춰졌다가 제일 마지막 세이브포인트가 사용된 후 없어지면 나타난다.</p>
<h6>구문</h6>
<p class="syntax"><span class="keyword">ROLLBACK</span> [ <span class="keyword">WORK</span> ] [ <span class="keyword">TO</span> [ <span class="keyword">SAVEPOINT</span> ] <span class="var">mark</span> ] [ ; ]<br />
<span class="var">mark</span>:<br />
_ a SQL identifier<br />
_ a host variable (starting with :)</p>
<p>앞에서는 <span class="keyword">ROLLBACK WORK</span> 문이 마지막 트랜잭션 이후로 입력된 모든 데이터베이스의 갱신을 제거하였다. <span class="keyword">ROLLBACK WORK</span> 문은 특정 세이브포인트 이후로 트랜잭션의 갱신을 되돌리는 부분 롤백에도 사용된다.</p>
<p><span class="var">mark</span>의 값이 주어지지 않으면 트랜잭션은 모든 갱신을 취소하면서 종료한다. 여기에는 트랜잭션에 만들어진 모든 세이브포인트도 포함한다. <span class="var">mark</span>가 주어지면 지정한 세이브포인트 이후의 것은 취소되고, 세이브포인트를 포함한 이전의 것은 갱신 사항이 남는다.</p>
<h6>예제</h6>
<p>다음 예제는 트랜잭션의 일부를 롤백하는 방법을 보여준다.</p>
<p>먼저 savepoint SP1, SP2를 설정한다.</p>
<p class="code">create class athlete2 (name varchar(40), gender char(1), nation_code char(3), event varchar(30));<br />
insert into athlete2(name, gender, nation_code, event)<br />
values ('Lim Kye-Sook', 'W', 'KOR', 'Hockey');<br />
savepoint SP1;<br />
<br />
select * from athlete2;<br />
insert into athlete2(name, gender, nation_code, event)<br />
values ('Lim Jin-Suk', 'M', 'KOR', 'Handball');<br />
<br />
select * from athlete2;<br />
savepoint SP2;<br />
<br />
rename class athlete2 as sportsman;<br />
select * from sportsman;<br />
rollback work to SP2;<br />
;xrun</p>
<p>위에서 athlete2 클래스의 이름 변경은 위의 부분 롤백에 의해서 롤백된다. 다음의 문장은 원래의 이름으로 질의를 수행하여 이것을 검증하고 있다.</p>
<p class="code">select * from athlete2;<br />
delete from athlete2 where name = 'Lim Jin-Suk';<br />
select * from athlete2;<br />
rollback work to SP2;<br />
;xrun</p>
<p>위에서 'Lim Jin-Suk' 을 삭제한 것은 이후에 진행되는 rollback work to SP2 명령문에 의해서 취소되었다.</p>
<p>다음은 SP1으로 롤백하는 경우이다.</p>
<p class="code">select * from athlete2;<br />
rollback work to SP1;<br />
select * from athlete2;<br />
commit work;<br />
;xrun</p>
<script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.writeIntopicBar)
	writeIntopicBar(0);


highlightSearch();
//-->
//]]></script>
</body>
</html>
