Install CUBRID PHP Extension
(LANG=ko_KR.utf8)

이 문서는 Unix/Linux 환경에서 PHP와 CUBRID PHP Extension을 함께 빌드하고 
설치하는 과정을 설명하는 문서입니다. 이 문서에서 업급되지 않는 Apache 설치, 
Apache와 PHP 연동은 Apache, PHP 각각의 INSTALL 문서를 참조하시기 바랍니다.

1) PHP와 CUBRID PHP Extension을 함께 설치하기

 PHP source를 받아 PHP를 설치하면서  CUBRID PHP Extension을 함께 설치할 수 
 있습니다. 본 문서에서는 Apache가 이미 /usr/local/apache에 설치되어 있고, 
 PHP를 설치할 디렉토리는 /usr/local/php라고 가정합니다. Apache 버전은 2.0 
 이상으로 가정합니다. PHP는 4.3 이상 버전이어야 합니다. 

 1. 다운로드 받은 cubrid_phpext.tar.gz 파일의 압축을 풀고 생성된 cubrid_phpext
   디렉토리로 이동합니다.
   
    > tar -xzvf cubrid_phpext.tar.gz
    > cd cubrid_phpext

 2. cubrid_phpext 디렉토리의 구조는 다음과 같습니다

    src : CUBRID PHP Extension source 파일이 들어있는 디렉토리
    INSTALL : 지금 보고 있는 문서 파일

 3. cci 디렉토리를 만들고 그 안에 CUBRID CCI library를 복사합니다.

    cubrid_phpext> mkdir cci
    cubrid_phpext> cp $CUBRID/lib/libcascci.a cci (64bit인 경우 lib64)
    cubrid_phpext> cp $CUBRID/include/cas_cci.h cci

 4. 설치된 CUBRID 에서 php module을 64bit로 컴파일하고자 한다면 $CUBRID/lib64 에 다음의 링크를 추가하여야 합니다.

    cubrid_phpext> cd /$CUBRID/lib64
    $CUBRID/lib64> ln -s libcascci.so.8.1.1 libcascci.so.8
    $CUBRID/lib64> ln -s libcascci.so.8.1.1 libcascci.so

 5. PHP 소스를 다운로드 받아 cubrid_phpext 디렉토리에서 압축을 풉니다.

    cd cubrid_phpext
    cubrid_phpext> tar -xzvf php-5.2.6.tar.gz
    
 6. php-5.2.6/ext 디렉토리로 이동하여 cubrid 디렉토리를 생성하고 이동합니다.
    
    cubrid_phpext> cd php-5.2.6/ext
    ext> mkdir cubrid
    ext> cd cubrid
    
 7. cubrid 디렉토리에 src 디렉토리에 있는 파일들의 symbolic link를 생성합니다.

    cubrid> ln -s ../../../src/* .
    
 8. PHP 소스의 root 디렉토리로 이동하여 configure 파일을 생성합니다.

    cubrid> cd ../..
    php-5.2.6> ./buildconf --force
    
 9. configure를 이용하여 Makefile을 생성합니다. 
   multi-thread 버전으로 빌드하려면 --enable-maintainer-zts 옵션을 줍니다.
   (php4.3, php4.4의 경우 --enable-experimental-zts)

    php-5.2.6> ./configure --prefix=/usr/local/php \
    --with-cubrid=shared \
    --enable-maintainer-zts \
    --with-apxs2=/usr/local/apache/bin/apxs
    
 10. make를 실행하여 빌드를 수행하고 설치합니다.

    php-5.2.6> make; make install
    
 11. php.ini-dist 파일을 /usr/local/php/lib 디렉토리에 php.ini 파일로 복사하고
    편집기로 열어서 CUBRID PHP Extension 관련 설정 사항을 입력합니다.

    php-5.2.6> cp php.ini-dist /usr/local/php/lib/php.ini
    php-5.2.6> vi /usr/local/php/lib/php.ini
    
 12. php.ini 파일의 extension_dir 변수에 빌드된 CUBRID PHP Extension이 위치한
    경로를, extension 변수에 파일 이름을 입력합니다. CUBRID PHP Extension은 
    /usr/local/php/lib/php/extension/no-debug-zts-xxxxxxxx 디렉토리에 cubrid.so 
    파일로 설치됩니다. cubrid.err_path 변수에는 cubrid_err.msg 파일이 위치한
    디렉토리의 경로를 입력합니다.

    extension_dir = "/usr/local/php/lib/php/extension/no-debug-zts-xxxxxxxx"
    extension = cubrid.so
    cubrid.err_path = $CUBRID_ERR_MSG_PATH


2) 이미 설치되어 있는 PHP에 CUBRID PHP Extension 설치하기

 PHP가 이미 설치되어 있는 경우 phpize를 이용하여 PHP Extenstion을 빌드할 수 있습니다.
 본 문서에서는 PHP가 /usr/local/php에 설치되어 있다고 가정하고 설명합니다.
 (phpize가 없을 경우 php.net 에서 실행하고자 하는 php 버젼과 일치하는 소스를 다운받아 컴파일 후 설치합니다.)
 PHP는 4.3 이상 버전이어야 합니다.

 1. 다운로드 받은 cubrid-php-scm-lastest.tar.gz 파일의 압축을 풀고 생성된 cubrid-php-scm-YYYY-MM-DD 디렉토리로 이동합니다.
    (svn으로 받으신 경우 cubrid-php-scm-YYYY-MM-DD 는 cubrid-php 입니다.)

    % tar -xzvf cubrid-php-scm-lastest.tar.gz
    % cd cubrid-php-scm-YYYY-MM-DD

 2. cubrid-php-scm-YYYY-MM-DD 디렉토리의 구조는 다음과 같습니다

    src : CUBRID PHP Extension source 파일이 들어있는 디렉토리
    INSTALL : 지금 보고 있는 문서 파일 (utf8 format)

 3. 설치된 CUBRID 에서 php module을 64bit로 컴파일하고자 한다면 $CUBRID/lib64 에 다음의 링크를 추가하여야 합니다.

    % cd $CUBRID/lib64
    % ln -s libcascci.so.8.1.1 libcascci.so.8
    % ln -s libcascci.so.8.1.1 libcascci.so

 4. cubrid-php-scm-YYYY-MM-DD/src 디렉토리 안에서 phpize를 수행합니다.

    % cd cubrid-php-scm-YYYY-MM-DD/src
    % /usr/local/php/bin/phpize

 5. PHP 실행시 CUBRID CCI library를 참조하도록 설정합니다.

    이 라이브러리는 CUBRID를 설치하면 설치된 디렉토리에 포함되어 있습니다. 
    apache 및 PHP가 64bit로 설치되었을 경우, LD_LIBRARY_PATH에 $CUBRID/lib64 가 반드시 포함되어야 합니다. 

    % export LD_LIBRARY_PATH=$CUBRID/lib:$CUBRID/lib64:$LD_LIBRARY_PATH

 6. cubrid-php-scm-YYYY-MM-DD/src에서 컴파일 시 CUBRID CAS의 library와 header파일이 인식 가능하도록 config.m4를 수정합니다. 

    % cd src
    % vi config.m4
      PHP_ADD_INCLUDE("$CUBRID/include")
      PHP_ADD_LIBRARY_WITH_PATH(cascci, "$CUBRID/lib64", CUBRID_SHARED_LIBADD)

 7. src 디렉토리 안에서 ./configure를 아래와 같은 옵션으로 수행합니다.

    % ./configure --with-php-config=/usr/local/php/bin/php-config

 8. 에러 없이 수행이 되었으면 compile 을 수행한다.
    % make

 9. 정상적으로 수행되었으면, modules 디렉토리에 cubrid.so가 생성됩니다. 
    이를 PHP를 설치한 디렉토리(/usr/local/php)의 lib/php 아래에 extensions 디렉토리를 
    만들고 그 안에 복사합니다.
    src> mkdir /usr/local/php/lib/php/extensions
    src> cp modules/cubrid.so /usr/local/php/lib/php/extensions

 8. cubrid error message file 을 복사합니다.
    src> cp cubrid_err.msg /usr/local/php/lib/php/extensions

 9. 완료 후 php.ini 편집기로 열어 CUBRID 관련 설정 사항을 입력합니다.
    src> vi /usr/local/php/lib/php.ini  

    extension_dir = "/usr/local/php/lib/php/extensions"
    extension=cubrid.so
    cubrid.err_path="/usr/local/php/lib/php/extensions"

