<?xml version="1.0" encoding="UTF-8"?>
<frame-impl>
<frame-statements>
<frame-statement name="sql_1">
SELECT /*+ LOCK_TIMEOUT(0.3), JDBC_CACHE(-1) */
	BOARD_ID, ARTICLE_ID, -ARTICLE_NO AS ARTICLE_NO,
	REPLY_NO_SEQ, REPLY_DEPTH, ARTICLE_TITLE, ARTICLE_TYPE,
	ARTICLE_CATEGORY, WRITER_ID, WRITER_NICKNAME, WRITER_INFO,
	-POSTED_TIME+TIMESTAMP '1/1/1970 9:00' AS POSTED_TIME,
	HAS_ATTACHMENTS,
	INCR(READ_COUNTER), RECOMMENDED_COUNTER,
	COMMENT_COUNTER, SCRAP_COUNTER
FROM
	NBD_ARTICLE_INFO
WHERE
	ARTICLE_ID=?
	AND ARTICLE_STATUS='Normal'
	AND IS_PRIVATE='N'
</frame-statement>

<frame-statement name="sql_2">
SELECT /*+ QUERY_CACHE(1) */
	CONTENT
FROM
	NBD_CONTENT
WHERE
	ARTICLE_ID=?
</frame-statement>

<frame-statement name="sql_3">
SELECT /*+ QUERY_CACHE(1) */
	ATTACHMENT_NO, ATTACHMENT_NAME, ATTACHMENT_TYPE, ATTACHMENT,
	ATTACHMENT_SIZE
FROM
	NBD_ATTACHMENT
WHERE
	ARTICLE_ID=?
</frame-statement>

<frame-statement name="sql_4">
SELECT /*+ QUERY_CACHE(1) */
	COMMENT_NO,
	COMMENT_TEXT, COMMENT_STATUS, WRITER_ID, WRITER_NICKNAME,
	-POSTED_TIME+TIMESTAMP '1/1/1970 9:00' AS POSTED_TIME,
	RECOMMENDED_COUNTER
FROM
	NBD_COMMENT
WHERE
	ARTICLE_ID=?
	AND
	COMMENT_STATUS='Normal'
	AND INST_NUM()&lt;100
</frame-statement>

<frame-statement name="sql_5">
SELECT
    ARTICLE_ID, -ARTICLE_NO AS ARTICLE_NO, REPLY_NO_SEQ, REPLY_DEPTH,
 	ARTICLE_TITLE, PREVIEW_TEXT, THUMBNAIL_IMAGE, ARTICLE_TYPE,
	ARTICLE_CATEGORY, ARTICLE_STATUS, WRITER_ID, WRITER_NICKNAME,
    -POSTED_TIME+TIMESTAMP '1/1/1970 9:00' AS POSTED_TIME,
	HAS_ATTACHMENTS, IS_SCRAPED, IS_POPULAR,
    READ_COUNTER, RECOMMENDED_COUNTER, COMMENT_COUNTER, SCRAP_COUNTER
FROM
	NBD_ARTICLE_INFO
WHERE
    BOARD_ID=?
    AND ARTICLE_NO BETWEEN 1-? AND 50-?
	AND REPLY_DEPTH=0
	AND ARTICLE_CATEGORY=?
	AND ARTICLE_STATUS='Normal'
	AND IS_PRIVATE='N'
	AND INST_NUM()=1
USING INDEX i_nbd_article_info_board_id_article_category_article_no(+)
UNION ALL
SELECT
    ARTICLE_ID, -ARTICLE_NO AS ARTICLE_NO, REPLY_NO_SEQ, REPLY_DEPTH,
 	ARTICLE_TITLE, PREVIEW_TEXT, THUMBNAIL_IMAGE, ARTICLE_TYPE,
	ARTICLE_CATEGORY, ARTICLE_STATUS, WRITER_ID, WRITER_NICKNAME,
    -POSTED_TIME+TIMESTAMP '1/1/1970 9:00' AS POSTED_TIME,
	HAS_ATTACHMENTS, IS_SCRAPED, IS_POPULAR,
    READ_COUNTER, RECOMMENDED_COUNTER, COMMENT_COUNTER, SCRAP_COUNTER
FROM
    NBD_ARTICLE_INFO
WHERE
    BOARD_ID=?
    AND ARTICLE_NO BETWEEN -50-? AND -1-?
    AND REPLY_DEPTH=0
    AND ARTICLE_CATEGORY=?
    AND ARTICLE_STATUS='Normal'
    AND IS_PRIVATE='N'
    AND INST_NUM()=1
USING INDEX ri_nbd_article_info_board_id_article_category_article_no(+)
</frame-statement>

<frame-statement name="sql_6">
SELECT
    REPLY_NO_SEQ, REPLY_DEPTH, ARTICLE_TITLE, PREVIEW_TEXT,
    THUMBNAIL_IMAGE, ARTICLE_TYPE, ARTICLE_CATEGORY, ARTICLE_STATUS,
    WRITER_ID, WRITER_NICKNAME,
    -POSTED_TIME+TIMESTAMP '1/1/1970 9:00' AS POSTED_TIME,
	HAS_ATTACHMENTS, IS_SCRAPED, IS_POPULAR,
    READ_COUNTER, RECOMMENDED_COUNTER, COMMENT_COUNTER, SCRAP_COUNTER
FROM
    NBD_ARTICLE_INFO
WHERE
    BOARD_ID=?
    AND ARTICLE_NO=-?
    AND REPLY_NO_SEQ LIKE ?||'%'
    AND REPLY_DEPTH &gt; ?
    AND ARTICLE_CATEGORY=?
    AND ARTICLE_STATUS='Normal'
    AND IS_PRIVATE='N'
</frame-statement>

<frame-statement name="sql_7">
SELECT
    COUNT(*) AS COUNT_ALL
FROM
    NBD_ARTICLE_INFO
WHERE
    BOARD_ID=?
    AND ARTICLE_CATEGORY=?
</frame-statement>
	
<frame-statement name="sql_8">
SELECT
    ARTICLE_ID, -ARTICLE_NO AS ARTICLE_NO, REPLY_NO_SEQ, REPLY_DEPTH,
	ARTICLE_TITLE, PREVIEW_TEXT, THUMBNAIL_IMAGE, ARTICLE_TYPE,
	ARTICLE_CATEGORY, WRITER_ID, WRITER_NICKNAME, WRITER_INFO,
    -POSTED_TIME+TIMESTAMP '1/1/1970 9:00' AS POSTED_TIME,
	HAS_ATTACHMENTS, IS_SCRAPED, IS_POPULAR,
    READ_COUNTER, RECOMMENDED_COUNTER, COMMENT_COUNTER, SCRAP_COUNTER
FROM
    NBD_ARTICLE_INFO
WHERE
    BOARD_ID=?
    AND ARTICLE_CATEGORY=?
    AND ARTICLE_STATUS='Normal'
    AND IS_PRIVATE='N'
    AND INST_NUM() BETWEEN ? AND ?
USING INDEX u_nbd_article_info_board_id_article_category_article_no_reply_depth_reply_no_seq_posted_time(+)
</frame-statement>
</frame-statements>

<frame-scripts>
<frame-script impl="impl_1">
	stmt = Statement.get('sql_1');
	stmt.setInt(1, IN.article_id);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.BOARD_ID = res.getInt(1)
		OUT.ARTICLE_ID = res.getInt(2);
		OUT.ARTICLE_NO = res.getInt(3);
		OUT.REPLY_NO_SEQ =  res.getString(4);
		OUT.REPLY_DEPTH = res.getInt(5);
		OUT.ARTICLE_TITLE = res.getString(6);
		OUT.ARTICLE_TYPE = res.getString(7);
		OUT.ARTICLE_CATEGORY = res.getInt(8);
		OUT.WRITER_ID = res.getString(9);
		OUT.WRITER_NICKNAME = res.getString(10);
		OUT.WRITER_INFO = res.getString(11);
		OUT.POSTED_TIME = res.getTimestamp(12);
		OUT.HAS_ATTACHMENTS = res.getString(13);
		OUT.READ_COUNTER = res.getInt(14);
		OUT.RECOMMENDED_COUNTER = res.getInt(15);
		OUT.COMMENT_COUNTER = res.getInt(16);
		OUT.SCRAP_COUNTER = res.getInt(17);
	}
	else {
	  throw 'no result for impl_1';
	}
</frame-script>

<frame-script impl="impl_2">
	stmt = Statement.get('sql_2');
	stmt.setInt(1, IN.article_id);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.CONTENT = res.getString(1);
	} 
	else {
		throw 'no result for impl_2';
	}
	
</frame-script>

<frame-script impl="impl_3">
	stmt = Statement.get('sql_3');
	stmt.setInt(1, IN.article_id);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.ATTACHMENT_NO = res.getInt(1);
		OUT.ATTACHMENT_NAME = res.getString(2);
		OUT.ATTACHMENT_TYPE = res.getString(3);
		OUT.ATTACHMENT = res.getString(4);
		OUT.ATTACHMENT_SIZE = res.getInt(5);
	}
	else {
	  throw 'no result for impl_3';
	}
</frame-script>

<frame-script impl="impl_4">
	stmt = Statement.get('sql_4');
	stmt.setInt(1, IN.article_id);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.COMMENT_NO = res.getInt(1);
		OUT.COMMENT_TEXT = res.getString(2);
		OUT.COMMENT_STATUS = res.getString(3);
		OUT.WRITER_ID = res.getString(4);
		OUT.WRITER_NICKNAME = res.getString(5);
		OUT.POSTED_TIME = res.getTimestamp(6);
		OUT.RECOMMENDED_COUNTER = res.getInt(7);
	}
	else {
	  throw 'no result';
	}
</frame-script>

<frame-script impl="impl_5">
	stmt = Statement.get('sql_5');
	stmt.setInt(1, IN.board_id);
	stmt.setInt(2, IN.article_no);
	stmt.setInt(3, IN.article_no);
	stmt.setInt(4, IN.article_category);
	stmt.setInt(5, IN.board_id);
	stmt.setInt(6, IN.article_no);
	stmt.setInt(7, IN.article_no);
	stmt.setInt(8, IN.article_category);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.ARTICLE_ID = res.getInt(1);
		OUT.ARTICLE_NO = res.getInt(2);
		OUT.REPLY_NO_SEQ = res.getString(3);
		OUT.REPLY_DEPTH = res.getInt(4);
		OUT.ARTICLE_TITLE = res.getString(5);
		OUT.PREVIEW_TEXT = res.getString(6);
		OUT.THUMBNAIL_IMAGE = res.getString(7);
		OUT.ARTICLE_TYPE = res.getString(8);
		OUT.ARTICLE_CATEGORY = res.getInt(9);
		OUT.ARTICLE_STATUS = res.getString(10);
		OUT.WRITER_ID = res.getString(11);
		OUT.WRITER_NICKNAME = res.getString(12);
		OUT.POSTED_TIME = res.getTimestamp(13);
		OUT.HAS_ATTACHMENTS = res.getString(14);
		OUT.IS_SCRAPED = res.getString(15);
		OUT.IS_POPULAR = res.getString(16);
		OUT.READ_COUNTER = res.getInt(17);
		OUT.RECOMMENDED_COUNTER = res.getInt(18);
		OUT.COMMENT_COUNTER = res.getInt(19);
		OUT.SCRAP_COUNTER = res.getInt(20);
	}
	else {
		throw 'no result';
	}
</frame-script>

<frame-script impl="impl_6">
	stmt = Statement.get('sql_6');
	stmt.setInt(1, IN.board_id);
	stmt.setInt(2, IN.article_no);
	stmt.setString(3, IN.reply_no_seq);
	stmt.setInt(4, IN.reply_depth);
	stmt.setInt(5, IN.article_category);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.REPLY_NO_SEQ = res.getString(1);
		OUT.REPLY_DEPTH = res.getInt(2);
		OUT.ARTICLE_TITLE = res.getString(3);
		OUT.PREVIEW_TEXT = res.getString(4);
		OUT.THUMBNAIL_IMAGE = res.getString(5);
		OUT.ARTICLE_TYPE = res.getString(6);
		OUT.ARTICLE_CATEGORY = res.getInt(7);
		OUT.ARTICLE_STATUS = res.getString(8);
		OUT.WRITER_ID = res.getString(9);
		OUT.WRITER_NICKNAME = res.getString(10);
		OUT.POSTED_TIME = res.getTimestamp(11);
		OUT.HAS_ATTACHMENTS = res.getString(12);
		OUT.IS_SCRAPED = res.getString(13);
		OUT.IS_POPULAR = res.getString(14);
		OUT.READ_COUNTER = res.getInt(15);
		OUT.RECOMMENDED_COUNTER = res.getInt(16);
		OUT.COMMENT_COUNTER = res.getInt(17);
		OUT.SCRAP_COUNTER = res.getInt(18);
	}
	else {
		// When NBD database is generated by dbgen tool There is no article which has reply_depth > 1
		// So do not throw exception here..
	}
</frame-script>

<frame-script impl="impl_7">
	stmt = Statement.get('sql_7');
	stmt.setInt(1, IN.board_id_lv);
	stmt.setInt(2, IN.article_category_lv);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.COUNT_ALL = res.getInt(1);
	}
	else {
		throw 'no result for impl_7';
	}
</frame-script>

<frame-script impl="impl_8">
	stmt = Statement.get('sql_8');
	stmt.setInt(1, IN.board_id);
	stmt.setInt(2, IN.article_category);
	stmt.setInt(3, IN.page_start_no);
	stmt.setInt(4, IN.page_end_no);
	res = stmt.executeQuery();
	if(res.next()) {
		OUT.ARTICLE_ID = res.getInt(1);
		OUT.ARTICLE_NO = res.getInt(2);
		OUT.REPLY_NO_SEQ = res.getString(3);
		OUT.REPLY_DEPTH = res.getInt(4);
		OUT.ARTICLE_TITLE = res.getString(5);
		OUT.PREVIEW_TEXT = res.getString(6);
		OUT.THUMBNAIL_IMAGE = res.getString(7);
		OUT.ARTICLE_TYPE = res.getString(8);
		OUT.ARTICLE_CATEGORY = res.getString(9);
		OUT.WRITER_ID = res.getString(10);
		OUT.WRITER_NICKNAME = res.getString(11);
		OUT.WRITER_INFO = res.getString(12);
		OUT.POSTED_TIME = res.getTimestamp(13);
		OUT.HAS_ATTACHMENTS = res.getString(14);
		OUT.IS_SCRAPED = res.getString(15);
		OUT.IS_POPULAR = res.getString(16);
		OUT.READ_COUNTER = res.getInt(17);
		OUT.RECOMMENDED_COUNTER = res.getInt(18);
		OUT.COMMENT_COUNTER = res.getInt(19);
		OUT.SCRAP_COUNTER  = res.getInt(20);
	}
	else {
		throw 'no result for impl_8';
	}
</frame-script>
</frame-scripts>
</frame-impl>

